#%RAML 1.0
title: Netto Experience API
version: v1
baseUri: https://api.netto.com/gateway/{version}
protocols: [HTTPS]

documentation:
  - title: Swedish Net Salary Calculator API
    content: |
      This API calculates net salary (nettolön) from gross salary (bruttolön) 
      based on Swedish tax rules. It provides endpoints for:
      - Tax calculation with full breakdown (municipal, regional, state tax, etc.)
      - Municipality and region lookup for tax rate selection

types:
  # ========================================
  # Tax Calculation Types
  # ========================================
  TaxCalculationRequest:
    type: object
    properties:
      municipalityId:
        type: string
        required: true
        description: UUID of the municipality for tax calculation
        example: "550e8400-e29b-41d4-a716-446655440000"
      grossMonthlySalary:
        type: number
        required: true
        description: Monthly gross salary in SEK
        example: 50000
      churchMember:
        type: boolean
        required: false
        default: false
        description: Whether the person is a member of the Swedish Church
        example: false
      isPensioner:
        type: boolean
        required: false
        default: false
        description: Whether the person is 65 years or older
        example: false

  TaxCalculationResponse:
    type: object
    properties:
      grossMonthlySalary:
        type: number
        description: Monthly gross salary in SEK
      grossYearlySalary:
        type: number
        description: Yearly gross salary in SEK
      municipalityName:
        type: string
        description: Name of the municipality
      regionName:
        type: string
        description: Name of the region (county)
      taxableIncome:
        type: number
        description: Taxable income after basic deduction
      basicDeduction:
        type: number
        description: Basic deduction (grundavdrag)
      municipalTax:
        type: number
        description: Municipal tax amount (yearly)
      regionalTax:
        type: number
        description: Regional/county tax amount (yearly)
      stateTax:
        type: number
        description: State tax amount (yearly, for high incomes)
      burialFee:
        type: number
        description: Burial fee (begravningsavgift, yearly)
      churchFee:
        type: number
        description: Church fee if member (yearly)
      totalTaxBeforeCredit:
        type: number
        description: Total tax before job tax credit
      jobTaxCredit:
        type: number
        description: Job tax credit (jobbskatteavdrag)
      totalTaxAfterCredit:
        type: number
        description: Total tax after job tax credit
      yearlyNetSalary:
        type: number
        description: Yearly net salary after all deductions
      monthlyNetSalary:
        type: number
        description: Monthly net salary after all deductions
      effectiveTaxRate:
        type: number
        description: Effective tax rate as percentage
      municipalTaxRate:
        type: number
        description: Municipal tax rate as percentage
      regionalTaxRate:
        type: number
        description: Regional tax rate as percentage

  # ========================================
  # Municipality and Region Types
  # ========================================
  Region:
    type: object
    properties:
      id:
        type: string
        description: UUID of the region
      code:
        type: string
        description: Region code (e.g., "24" for Västerbotten)
      name:
        type: string
        description: Name of the region

  Municipality:
    type: object
    properties:
      id:
        type: string
        description: UUID of the municipality
      code:
        type: string
        description: Municipality code
      name:
        type: string
        description: Name of the municipality
      regionId:
        type: string
        description: UUID of the parent region

  # ========================================
  # Error Types
  # ========================================
  ErrorResponse:
    type: object
    properties:
      error:
        type: string
        description: Error code
      message:
        type: string
        description: Human-readable error message
      timestamp:
        type: datetime
        description: When the error occurred

  ValidationErrorResponse:
    type: object
    properties:
      timestamp:
        type: datetime
      status:
        type: integer
      error:
        type: string
      messages:
        type: array
        items: string
        description: List of validation error messages

# ========================================
# API Endpoints
# ========================================

/tax:
  /calculate:
    post:
      description: Calculate net salary with full Swedish tax breakdown
      body:
        application/json:
          type: TaxCalculationRequest
          example: |
            {
              "municipalityId": "550e8400-e29b-41d4-a716-446655440000",
              "grossMonthlySalary": 50000,
              "churchMember": false,
              "isPensioner": false
            }
      responses:
        200:
          body:
            application/json:
              type: TaxCalculationResponse
              example: |
                {
                  "grossMonthlySalary": 50000.00,
                  "grossYearlySalary": 600000.00,
                  "municipalityName": "Umeå",
                  "regionName": "Västerbotten",
                  "taxableIncome": 558135.60,
                  "basicDeduction": 41864.40,
                  "municipalTax": 121673.53,
                  "regionalTax": 60622.16,
                  "stateTax": 0.00,
                  "burialFee": 1548.00,
                  "churchFee": 0.00,
                  "totalTaxBeforeCredit": 183843.69,
                  "jobTaxCredit": 38517.24,
                  "totalTaxAfterCredit": 145326.45,
                  "yearlyNetSalary": 454673.55,
                  "monthlyNetSalary": 37889.46,
                  "effectiveTaxRate": 24.22,
                  "municipalTaxRate": 21.79,
                  "regionalTaxRate": 10.86
                }
        400:
          body:
            application/json:
              type: ValidationErrorResponse
              example: |
                {
                  "timestamp": "2025-12-29T14:30:00.000",
                  "status": 400,
                  "error": "Validation Failed",
                  "messages": [
                    "municipalityId: Municipality ID is required",
                    "grossMonthlySalary: Gross salary must be a positive value"
                  ]
                }
        404:
          body:
            application/json:
              type: ErrorResponse
              example: |
                {
                  "error": "NOT_FOUND",
                  "message": "Municipality not found",
                  "timestamp": "2025-12-29T14:30:00Z"
                }
        500:
          body:
            application/json:
              type: ErrorResponse

/regions:
  get:
    description: List all Swedish regions (län)
    responses:
      200:
        body:
          application/json:
            type: Region[]
            example: |
              [
                {
                  "id": "550e8400-e29b-41d4-a716-446655440001",
                  "code": "24",
                  "name": "Västerbotten"
                },
                {
                  "id": "550e8400-e29b-41d4-a716-446655440002",
                  "code": "25",
                  "name": "Norrbotten"
                }
              ]
      500:
        body:
          application/json:
            type: ErrorResponse

/municipalities:
  get:
    description: List all Swedish municipalities (kommuner)
    responses:
      200:
        body:
          application/json:
            type: Municipality[]
      500:
        body:
          application/json:
            type: ErrorResponse

  /by-region:
    /{regionId}:
      uriParameters:
        regionId:
          type: string
          description: UUID of the region to filter by
      get:
        description: List municipalities in a specific region
        responses:
          200:
            body:
              application/json:
                type: Municipality[]
          404:
            body:
              application/json:
                type: ErrorResponse
                example: |
                  {
                    "error": "NOT_FOUND",
                    "message": "Region not found",
                    "timestamp": "2025-12-29T14:30:00Z"
                  }
          500:
            body:
              application/json:
                type: ErrorResponse

  /{id}:
    uriParameters:
      id:
        type: string
        description: UUID of the municipality
    get:
      description: Get a specific municipality by ID
      responses:
        200:
          body:
            application/json:
              type: Municipality
        404:
          body:
            application/json:
              type: ErrorResponse
              example: |
                {
                  "error": "NOT_FOUND",
                  "message": "Municipality not found",
                  "timestamp": "2025-12-29T14:30:00Z"
                }
        500:
          body:
            application/json:
              type: ErrorResponse
